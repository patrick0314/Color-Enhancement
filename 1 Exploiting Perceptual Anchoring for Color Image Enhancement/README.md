# Exploiting-Perceptual-Anchoring-for-Color-Image-Enhancement

According to ["Exploiting Perceptual Anchoring for Color Image Enhancement"](https://ieeexplore.ieee.org/document/7337421), we follow the step in the paper and implement it.

1. Load images. Notice that we use opencv to load image, so the format is with BGR color space. For convenience, we change the BGR color space to RGB color space and then divided by 255.

2. According to the paper, we set $\gamma_rf$, $\gamma_gf$, $\gamma_bf$, $M_f$, $\gamma_rl$, $\gamma_gl$, $\gamma_bl$, $M_l$. Follor the fomula in the paper, we change the image from RGB color space to XYZ color space with $\gamma_rf$, $\gamma_gf$, $\gamma_bf$, $M_f$. Besides, set a white vector $[1, 1, 1]$ and also change it to XYZ color space.

3. In the light of the paper, given $Y_b$, $L_a$, $c$, $N_c$, $F$, and computed XYZ image, white XYZ, we can use CIECAM02 model to calculate hue, lightness and chroma.

4. At the step, we need to invert the CIECAM02 model. Before we start, we need to do something to white XYZ. We use redefine the white XYZ with $\gamma_rl$, $\gamma_gl$, $\gamma_bl$, $M_l$. After inversion of CIECAM02 model, we can get the enhanced XYZ image.

5. Last, we change enhanced XYZ image into RGB color space. Due to enhancement, the range of color values will exceed 1. We use clip function to solve this problem. However, this function will cause the enhanced image loss some details. Therefore, we use the fomula with lightness $J$ and chroma $C$ to modify the curve to an one-to-one mapping.

## Requirement

```
numpy==1.23.5
opencv-python==4.6.0.66
```

## Usage

* [ColorPatchEnhanced.py](https://github.com/patrick0314/DIP-Final-Project/blob/main/1%20Exploiting%20Perceptual%20Anchoring%20for%20Color%20Image%20Enhancement/ColorPatchEnhanced.py) implement color enhancement on input data folder - [color patch](https://github.com/patrick0314/DIP-Final-Project/tree/main/1%20Exploiting%20Perceptual%20Anchoring%20for%20Color%20Image%20Enhancement/images/color%20patch) and save the results with name `v1` in the folder - [color patch results](https://github.com/patrick0314/DIP-Final-Project/tree/main/1%20Exploiting%20Perceptual%20Anchoring%20for%20Color%20Image%20Enhancement/images/color%20patch%20results)

* [NaturalImgEnhanced.py](https://github.com/patrick0314/DIP-Final-Project/blob/main/1%20Exploiting%20Perceptual%20Anchoring%20for%20Color%20Image%20Enhancement/NaturalImgEnhanced.py) implement **method 1** color enhancement on input data folder - [natural image](https://github.com/patrick0314/DIP-Final-Project/tree/main/1%20Exploiting%20Perceptual%20Anchoring%20for%20Color%20Image%20Enhancement/images/natural%20image) and save the results with name `v1` in the folder - [natural image results](https://github.com/patrick0314/DIP-Final-Project/tree/main/1%20Exploiting%20Perceptual%20Anchoring%20for%20Color%20Image%20Enhancement/images/natural%20image%20results)

* [SimulatingImgDimBack.py](https://github.com/patrick0314/DIP-Final-Project/blob/main/1%20Exploiting%20Perceptual%20Anchoring%20for%20Color%20Image%20Enhancement/SimulatingImgDimBack.py) can show the comparison between original img & the img with dim backlight and save the results in the folder - [results](https://github.com/patrick0314/DIP-Final-Project/tree/main/1%20Exploiting%20Perceptual%20Anchoring%20for%20Color%20Image%20Enhancement/images/results)

## Results

The left part is original image. The middle part is ground truth of ["Exploiting Perceptual Anchoring for Color Image Enhancement"](https://ieeexplore.ieee.org/document/7337421). The right part is the results of our implement.

![01v1](https://user-images.githubusercontent.com/47914151/208274723-4cf9fbf9-ac95-46bb-b416-84efeb9691bc.png)

![03v1](https://user-images.githubusercontent.com/47914151/208274743-fafc55f0-b418-424f-9cc2-6a20bcf42dcb.png)

![04v1](https://user-images.githubusercontent.com/47914151/208274753-695275ee-7751-4e67-ae5d-0be9f4c72654.png)

![06v1](https://user-images.githubusercontent.com/47914151/208274766-3dc59f60-4d25-4612-8721-67eecc32a6ca.png)

![11v1](https://user-images.githubusercontent.com/47914151/208274814-364fb970-f224-4ba3-9a31-c1ab28ebb4f5.png)
